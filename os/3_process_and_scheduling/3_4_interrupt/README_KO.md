# π”‘ Interrupt

<br>

## π“ μΈν„°λ½νΈλ€?

β— CPUκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•κ³  μμ„ λ•, μ…μ¶λ ¥ ν•λ“μ›¨μ–΄ λ“±μ μ¥μΉλ‚ λλ” μμ™Έμƒν™©μ΄ λ°μƒν•μ—¬ μ²λ¦¬κ°€ ν•„μ”ν•  κ²½μ°μ— CPUμ— μ•λ ¤μ„ μ²λ¦¬ν•λ” κΈ°μ 

<br>

## π“ Interrupt ν•„μ” μ΄μ 

β— Preemptive Scheduler κµ¬ν„
```
β—‹ ν”„λ΅μ„Έμ¤ running μ¤‘μ— μ¤μΌ€μ¥΄λ¬κ°€ μ΄λ¥Ό μ¤‘λ‹¨μ‹ν‚¤κ³ , λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤λ΅ κµμ²΄ν•κΈ° μ„ν•΄, ν„μ¬ ν”„λ΅μ„Έμ¤ μ‹¤ν–‰μ„ μ¤‘λ‹¨μ‹ν‚΄
  - κ·Έλ¬λ ¤λ©΄, μ¤μΌ€μ¥΄λ¬ μ½”λ“κ°€ μ‹¤ν–‰μ΄ λμ„, ν„ ν”„λ΅μ„Έμ¤ μ‹¤ν–‰μ„ μ¤‘μ§€μ‹μΌμ•Ό ν•¨
```

β— IO Deviceμ™€μ μ»¤λ®¤λ‹μΌ€μ΄μ…
```
β—‹ μ €μ¥λ§¤μ²΄μ—μ„ λ°μ΄ν„° μ²λ¦¬ μ™„λ£μ‹, ν”„λ΅μ„Έμ¤λ¥Ό κΉ¨μ›μ•Ό ν•¨ (block state -> ready state)
```

β— μμ™Έ μƒν™© ν•Έλ“¤λ§
```
β—‹ CPUκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•κ³  μμ„ λ•, μ…μ¶λ ¥ ν•λ“μ›¨μ–΄ λ“±μ μ¥μΉλ‚ λλ” μμ™Έμƒν™©μ΄ λ°μƒν•  κ²½μ°, CPUκ°€ ν•΄λ‹Ή μ²λ¦¬λ¥Ό ν•  μ μλ„λ΅ CPUμ— μ•λ ¤μ¤μ•Ό ν•¨
```

![Scheduling](./image/scheduling.png)

<br>

## π“ Interrupt μ²λ¦¬ μ

β— CPUκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•κ³  μμ„ λ• μ…μ¶λ ¥ ν•λ“μ›¨μ–΄ λ“±μ μ¥μΉ μ΄μ λ°μƒ
```
β—‹ νμΌ μ²λ¦¬κ°€ λλ‚¬λ‹¤λ” κ²ƒμ„ μ΄μμ²΄μ μ— μ•λ ¤μ£ΌκΈ°
β—‹ μ΄μμ²΄μ λ” ν•΄λ‹Ή ν”„λ΅μ„Έμ¤λ¥Ό block stateμ—μ„ μ‹¤ν–‰ λ€κΈ°(ready) μƒνƒλ΅ ν”„λ΅μ„Έμ¤ μƒνƒ λ³€κ²½ν•κΈ°
```
β— CPUκ°€ ν”„λ΅κ·Έλ¨μ„ μ‹¤ν–‰ν•κ³  μμ„ λ• μμ™Έ μƒν™©μ΄ λ°μƒ
```
β—‹ 0μΌλ΅ λ‚λ„λ” κ³„μ‚°μ΄ λ°μƒν•΄μ„, μμ™Έ λ°μƒμ„ μ΄μμ²΄μ μ— μ•λ ¤μ£ΌκΈ°
β—‹ μ΄μμ²΄μ κ°€ ν•΄λ‹Ή ν”„λ΅μ„Έμ¤ μ‹¤ν–‰ μ¤‘μ§€ / μ—λ¬ ν‘μ‹
```

<br>

## π“ μ΄λ²¤νΈμ™€ μΈν„°λ½νΈ

β— μΈν„°λ½νΈλ” μΌμΆ…μ μ΄λ²¤νΈλ΅ λ¶λ¦Ό<br>
β— μ΄λ²¤νΈμ— λ§κ² μ΄μμ²΄μ κ°€ μ²λ¦¬<br>

<br>

## π“ μ£Όμ” Interrupt

β— 1. Divide-by-Zero Interrupt
```
#include <stdio.h>

int main()
{
    int data;
    int divider = 0;
    data = 1 / divider; // interrupt
    return 0;
}
```

β— 2. Timer Interrupt
```
β—‹ ν•λ“μ›¨λ΅λ΅λ¶€ν„° μΌμ • μ‹κ°„λ§λ‹¤ νƒ€μ΄λ¨Έ μΈν„°λ½νΈλ¥Ό μ΄μμ²΄μ μ— μ•λ ¤μ¤
```

β— 3. IO Interrupt
```
β—‹ Printer
β—‹ Keyboard
β—‹ Mouse
β—‹ SSD
```

<br>

## π“ μΈν„°λ½νΈ μΆ…λ¥

β— Inner Interrupt
```
β—‹ μ£Όλ΅ ν”„λ΅κ·Έλ¨ λ‚΄λ¶€μ—μ„ μλ»λ λ…λ Ή λλ” μλ»λ λ°μ΄ν„° μ‚¬μ©μ‹ λ°μƒ
  - 0μΌλ΅ λ‚λ΄μ„ λ•
  - μ‚¬μ©μ λ¨λ“μ—μ„ ν—μ©λμ§€ μ•μ€ λ…λ Ή λλ” κ³µκ°„ μ ‘κ·Όμ‹
  - κ³„μ‚° κ²°κ³Όκ°€ Overflow / Underflow
```
β— External Interrupt
```
β—‹ μ£Όλ΅ ν•λ“μ›¨μ–΄μ—μ„ λ°μƒλλ” μ΄λ²¤νΈ
  - μ „μ› μ΄μƒ
  - κΈ°κ³„ λ¬Έμ 
  - ν‚¤λ³΄λ“λ“± IOκ΄€λ ¨ μ΄λ²¤νΈ
  - Timer μ΄λ²¤νΈ
```
β— λ‚΄λ¶€ μΈν„°λ½νΈλ” μ£Όλ΅ ν”„λ΅κ·Έλ¨ λ‚΄λ¶€μ—μ„ λ°μƒν•λ―€λ΅, μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈλΌκ³ λ„ ν•¨<br>
β— μ™Έλ¶€ μΈν„°λ½νΈλ” μ£Όλ΅ ν•λ“μ›¨μ—μ„ λ°μƒν•λ―€λ΅, ν•λ“μ›¨μ–΄ μΈν„°λ½νΈλΌκ³ λ„ ν•¨<br>

<br>

## π“ System Call Interrupt

β— μ‹μ¤ν…μ½ μ‹¤ν–‰μ„ μ„ν•΄μ„λ” κ°•μ λ΅ μ½”λ“μ— μΈν„°λ½νΈ λ…λ Ήμ„ λ„£μ–΄, CPUμ—κ² μ‹¤ν–‰μ‹μΌμ•Ό ν•λ‹¤.<br>
β— μ‹μ¤ν… μ½ μ‹¤μ  μ½”λ“
```
mov eax, // eax λ μ§€μ¤ν„°μ— μ‹μ¤ν… μ½ λ²νΈλ¥Ό λ„£λ”λ‹¤ (ex 1)
mov ebx, // ebx λ μ§€μ¤ν„°μ—λ” μ‹μ¤ν… μ½μ— ν•΄λ‹Ήν•λ” μΈμκ°’μ„ λ„£λ”λ‹¤ (ex 0)
int 0x80 // μ†ν”„νΈμ›¨μ–΄ μΈν„°λ½νΈ λ…λ Ήμ„ νΈμ¶ν•λ©΄μ„ 0x80κ°’μ„ λ„κ²¨μ¤
```

<br>

## π“ Interrupt And System Call (κ³ κΈ‰)

β— μ‹μ¤ν…μ½ μΈν„°λ½νΈ λ…λ Ήμ„ νΈμ¶ν•λ©΄μ„ 0x80κ°’μ„ λ„κ²¨μ¤
```
β—‹ 1. CPUλ” μ‚¬μ©μ λ¨λ“λ¥Ό μ»¤λ„ λ¨λ“λ΅ λ°”κΏ
β—‹ 2. IDT(Iterrupt Descriptor Table)μ—μ„ 0x80μ— ν•΄λ‹Ήν•λ” μ£Όμ†(ν•¨μ)λ¥Ό μ°Ύμ•„μ„ μ‹¤ν–‰ν•¨
β—‹ 3. system_call() ν•¨μμ—μ„ eaxλ΅λ¶€ν„° μ‹μ¤ν… μ½ λ²νΈλ¥Ό μ°Ύμ•„μ„, ν•΄λ‹Ή λ²νΈμ— λ§λ” μ‹μ¤ν…μ½ ν•¨μλ΅ μ΄λ™
β—‹ 4. ν•΄λ‹Ή μ‹μ¤ν… μ½ ν•¨μ μ‹¤ν–‰ ν›„, λ‹¤μ‹ μ»¤λ„λ¨λ“μ—μ„ μ‚¬μ©μ λ¨λ“λ΅ λ³€κ²½ν•κ³ , λ‹¤μ‹ ν•΄λ‹Ή ν”„λ΅μ„Έμ¤ λ‹¤μ μ½”λ“ μ§„ν–‰
```

<br>

## π“ User / Kernel Mode and Process, Interrupt

![ProcessInterrupt](./image/process_interrupt.png)

<br>

## π“ μΈν„°λ½νΈμ™€ IDT

β— μΈν„°λ½νΈλ” λ―Έλ¦¬ μ •μλμ–΄ κ°κ° λ²νΈμ™€ μ‹¤ν–‰ μ½”λ“λ¥Ό κ°€λ¦¬ν‚¤λ” μ£Όμ†κ°€ κΈ°λ΅λμ–΄ μμ
```
β—‹ Where ? IDT(Iterrupt Descriptor Table)μ— κΈ°λ΅
β—‹ When ? μ»΄ν“¨ν„° λ¶€ν…μ‹ μ΄μμ²΄μ κ°€ κΈ°λ΅
β—‹ Which Code ? μ΄μμ²΄μ  λ‚΄λ¶€ μ½”λ“
```
β— EX
```
β—‹ ν•­μƒ μΈν„°λ½νΈ λ°μƒμ‹, IDTλ¥Ό ν™•μΈ
β—‹ μ‹μ¤ν…μ½ μΈν„°λ½νΈ λ…λ Ήμ€ 0x80 λ²νΈκ°€ λ―Έλ¦¬ μ •μ
β—‹ μΈν„°λ½νΈ 0x80μ— ν•΄λ‹Ήν•λ” μ΄μμ²΄μ  μ½”λ“λ” system_call()μ΄λΌλ” ν•¨μ
β—‹ μ¦‰, IDTμ—λ” 0x80 -> system_call() μ™€ κ°™μ€ μ •λ³΄κ°€ κΈ°λ΅λμ–΄ μμ
```
β— Linux EX
```
β—‹ 0 ~ 31: μμ™Έμƒν™© μΈν„°λ½νΈ (μΌλ¶€λ” μ •μ μ•λ μ±„λ΅ λ‚¨κ²¨μ Έ μμ)
β—‹ 32 ~ 47: ν•λ“μ›¨μ–΄ μΈν„°λ½νΈ (μ£Όλ³€μ¥μΉ μΆ…λ¥ / κ°―μμ— λ”°λΌ λ³€κ²½κ°€λ¥)
β—‹ 128: μ‹μ¤ν… μ½
```

<br>

## π“ Interrupt And Process

β— 1. ν”„λ΅μ„Έμ¤ μ‹¤ν–‰μ¤‘ μΈν„°λ½νΈ λ°μƒ<br>
β— 2. ν„ ν”„λ΅μ„Έμ¤ μ‹¤ν–‰ μ¤‘λ‹¨<br>
β— 3. μΈν„°λ½νΈ μ²λ¦¬ ν•¨μ μ‹¤ν–‰(μ΄μμ²΄μ )<br>
β— 4. ν„ ν”„λ΅μ„Έμ¤ μ¬μ‹¤ν–‰<br>

<br>

## π“ Interrupt And Scheduler

β— μμ‹λ΅ νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ°μƒ
```
β—‹ μ΄μμ²΄μ κ°€ νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ°μƒ νμλ¥Ό κΈ°μ–µν•΄μ„ 5λ² νƒ€μ΄λ¨Έ μΈν„°λ½νΈ λ°μƒν•λ©΄, ν„μ¬ ν”„λ΅μ„Έμ¤λ¥Ό λ‹¤λ¥Έ ν”„λ΅μ„Έμ¤λ΅ λ°”κΏ”μ¤€λ‹¤
```

<br>
<br>

---

##### π“ μ°Έκ³ κ°•μοΌ[μ»΄ν“¨ν„° κ³µν•™ μ „κ³µ ν•„μ μ¬μΈμ› ν¨ν‚¤μ§€ Online](https://fastcampus.co.kr/dev_online_cs)